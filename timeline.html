<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
        <title>Waterdeep</title>

        <style>
            body, html {
                font-family: arial, sans-serif;
                font-size: 11pt;
            }

            .buttons {
                margin: 20px 0;
            }

            .buttons input {
                padding: 10px;
            }

            .vis-item {
                border-color: orange;
                background-color: yellow;
            }
        </style>

        <!-- Load the AJAX API aka Google API  -->
        <script src="https://www.gstatic.com/charts/loader.js"></script>
        <script src="https://visjs.github.io/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
        <link href="https://visjs.github.io/vis-timeline/styles/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <div id="visualization"></div>

        <script>

        // Create an empty DataSet.
        // This DataSet is used for two way data binding with the Timeline.
        var items = new vis.DataSet();

        // create a timeline
        var container = document.getElementById('visualization');

        vis.moment.updateLocale('harptos_us', {
            months: 'Hammer_Alturiak_Ches_Tarsakh_Mirtul_Kythorn_Flamerule_Eleasis_Eleint_Marpenoth_Uktar_Nightal'.split('_'),
            weekdays: '________'.split('_'),
            weekdaysShort: '________'.split('_'),
            weekdaysMin: '________'.split('_'),
            monthsShort: 'Hammer_Alturiak_Ches_Tarsakh_Mirtul_Kythorn_Flamerule_Eleasis_Eleint_Marpenoth_Uktar_Nightal'.split('_'),
            additionals: 'Midwinter_Greengrass_Midsummer_Highharvestide_Feast of the Moon_Shieldmeet'.split('_'),
            additionalsShort: 'MW_GG_MS_HH_FM_SM'.split('_'),
            era: 'Dale Reckoning',
            eraShort: 'DR',
            formats: {
                L: 'MM/DD/YYYY',
                LL: 'MMMM D YYYY',
                LLL: 'MMMM D YYYY N',
                LLLL: 'dddd, MMMM Do YYYY N'},
            ordinal : function (n, token) {
                const s = ["th", "st", "nd", "rd"];
                const v = n % 100;
                return (s[(v - 20) % 10] || s[v] || s[0]);
            }
        });

        var options = {
            editable: true,
            showWeekScale: false,
            showCurrentTime: false,
            align: 'left',
            moment: function(date) {
                return vis.moment(date);
            },
            locale: 'harptos_us'
        };
        var timeline = new vis.Timeline(container, items, options);

        items.clear();
        // Load the visualization API and the corechart packages
        google.charts.load('current',{'packages':['corechart','table']});
        
        // Set callback when the google visualization API is loaded
        google.charts.setOnLoadCallback(drawAllSheets);
        function drawAllSheets() {
            // Create Google Sheets query
            var queryString = 'https://docs.google.com/spreadsheets/d/1aXGMp6uO6CVxMFS8kxHfm5EazdeVisL_riQtsVxaZUg/gviz/tq?sheet=timeline&headers=1&tq=' + encodeURIComponent('SELECT A, B, C, D');
            console.log(queryString);
            query1 = new google.visualization.Query(queryString);
            query1.send(chartfunction);
            function chartfunction (response) {
                // Get and plot data
                var data = response.getDataTable();
                var data2 = [];
                for (i=0; i<data.getNumberOfRows(); i++) {
                        data2[i] = {};
                        var content1 = data.getValue(i, 0);
                        var start1 = data.getValue(i, 1);
                        var end1 = data.getValue(i, 2);
                        data2[i]["id"] = i;
                        console.log(content1)
                        data2[i]["content"] = content1.replace(/\n/g, "<br>");
                        data2[i]["start"] = start1;
                        if (start1 != end1) {
                            data2[i]["end"] = end1;
                        };
                    }
                items.add(data2);
                timeline.fit();
            }
        }
        </script>
    </body>
</html>
